<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <!--引入jquery的js -->
    <script type="text/javascript" src="../js/jquery.min.js"></script>
    <script type="text/javascript" src="../uploadify/jquery.uploadify.min.js"></script>
    <link rel="stylesheet" type="text/css" href="../uploadify/uploadify.css">

    <!-- 引入bootstrap的css、js -->
    <link type="text/css" rel="stylesheet" href="../js/bootstrap3/css/bootstrap.css">
    <script type="text/javascript" src="../js/bootstrap3/js/bootstrap.js"></script>
    <!-- 引入bootstrap table的css、js -->
    <link type="text/css" rel="stylesheet" href="../js/bootstrap-table/bootstrap-table.css">
    <script type="text/javascript" src="../js/bootstrap-table/bootstrap-table.js"></script>
    <script type="text/javascript" src="../js/bootstrap-table/locale/bootstrap-table-zh-CN.js"></script>
    <!-- 引入bootstrap bootbox的css、js -->
    <script type="text/javascript" src="../js/bootstrap-bootbox/bootbox.js"></script>
    <!-- 引入bootstrap datetime的css、js -->
    <link type="text/css" rel="stylesheet" href="../js/bootstrap-datetimepicker/css/bootstrap-datetimepicker.css">
    <script type="text/javascript" src="../js/bootstrap-datetimepicker/js/bootstrap-datetimepicker.js"></script>
    <script type="text/javascript"
            src="../js/bootstrap-datetimepicker/js/locales/bootstrap-datetimepicker.zh-CN.js"></script>
    <!-- 引入bootstrap fileinput的css、js -->
    <link type="text/css" rel="stylesheet" href="../js/bootstrap-fileinput/css/fileinput.css">
    <script type="text/javascript" src="../js/bootstrap-fileinput/js/fileinput.js"></script>
    <script type="text/javascript" src="../js/bootstrap-fileinput/js/locales/zh.js"></script>

</head>
<body>
<div>
    <table id="merchantsTable">
        <button type="button" class="btn btn-success glyphicon glyphicon-minus" onclick="deleteMany()">删除</button>
        <button type="button" class="btn btn-primary glyphicon glyphicon-refresh" onclick="window.location.reload()">
            刷新
        </button>
        <button onclick="openAdd()" type="button" class="btn btn-primary glyphicon glyphicon-plus">新增</button>
    </table>
</div>
</body>
<script>
    $(function () {
        initMerchantsTable();
    })

    //初始化表格
    function initMerchantsTable() {
        $("#merchantsTable").bootstrapTable({
            toolbar: '#toolbar',
            url: "../merchant/findMerchantPage",
            pagination: true,//开启分页
            pageList: [1, 3, 5, 7, 20, 50],//分页组件
            pageNumber: 1,
            pageSize: 5,//默认每页条数
            sidePagination: 'server',//分页方式：client客户端分页，server服务端分页
            striped: false,//条纹表格
            queryParams: function () {
                return {
                    page: this.pageNumber,
                    rows: this.pageSize
                };
            },
            columns: [
                {field: '123', checkbox: true, align: 'center'},
                {field: 'id', title: '主键id', align: 'center'},
                {field: 'referencenumber', title: '批准文号', align: 'center'},
                {field: 'swag', title: '推广商品', align: 'center'},
                {field: 'promotionofgoods', title: '活动商品', align: 'center'},
                {field: 'swagprice', title: '推广商品价格', align: 'center'},
                {field: 'promotionprice', title: '活动商品价格', align: 'center'},
                {
                    field: 'invoicetype', title: '发票类型', align: 'center', formatter: function (value, row, index) {
                        var invoicetype = row.invoicetype == 1 ? "电子" : '纸张';
                        return invoicetype;
                    }
                },
                {field: 'invoicecontents', title: '发票内容', align: 'center'},
                {
                    field: 'invoiceprice', title: '发票价格', align: 'center',formatter: function (value, row, index) {
                        return value + "(元)";
                    }
                },

                {
                    field: 'operation',
                    title: '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;操&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;作&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;',
                    align: 'center',
                    formatter: function (value, row, index) {
                        return operation = row.updown == 1 ? "<button type='button' class='btn btn-info' onclick='openUpdate(" + row.id + ")'>查看订单</button>" +"&nbsp;&nbsp;"+  "<button type='button' class='btn btn-success' onclick='delOne(" + row.id + ")'>删除订单</button>" : "<button type='button' class='btn btn-info' onclick='openUpdate(" + row.id + ")'>查看订单</button>" +"&nbsp;&nbsp;" +"&nbsp;&nbsp;"+ "<button type='button' class='btn btn-success' onclick='delOne(" +row.id+ ")'>删除订单</button>";
                    }
                }

            ]
        })
    }


    //新增所需
    var res;

    function createAddContent(url) {
        $.ajax({
            url: url,
            async: false,
            success: function (data) {
                res = data;
            }
        });
        return res;
    }

    //打开新增弹框
    function openAdd() {
        bootbox.dialog({
            title: '添加用户',
            message: createAddContent("../page/toaddshangjia"),
            closeButton: true,//是否显示关闭按钮
            buttons: {
                "success": {
                    "label": "<i class='icon-ok'></i> 保存",
                    "className": "btn-sm btn-success",
                    "callback": function () {
                        var swag = $("#swag").val();
                        var promotionofgoods = $("#promotionofgoods").val();
                        var swagprice = $("#swagprice").val();
                        var promotionprice = $("#promotionprice").val();
                        /*var invoicetype = $("#invoicetype").val();*/
                        var invoicetype = $('#invoicetype input:radio:checked').val();
                        var invoicecontents = $("#invoicecontents").val();
                        var invoiceprice = $("#invoiceprice").val();
                        var referencenumber = $("#referencenumber").val();
                        $.ajax({
                            url: '../merchant/saveMerchant',
                            contentType: 'application/json',
                            type: 'post',
                            // data:$("#bookForm").serialize(),
                            data: JSON.stringify({
                                'swag': swag,
                                'promotionofgoods': promotionofgoods,
                                'swagprice': swagprice,
                                'promotionprice': promotionprice,
                                'invoicetype': invoicetype,
                                'invoicecontents': invoicecontents,
                                'invoiceprice': invoiceprice
                            }),
                            success: function () {
                                $('#merchantsTable').bootstrapTable('refresh');

                            }
                        });
                    }
                },
                "cancel": {
                    "label": "<i class='icon-info'></i> 取消",
                    "className": "btn-sm btn-danger",
                    "callback": function () {

                    }
                }
            }

        });
    }

    //单删
    function delOne(id) {
        bootbox.confirm({
            size: "small",
            title: "提示！",
            message: "确定删除选中信息吗？",
            buttons: {
                confirm: {
                    label: '确定',
                    className: 'btn-success'
                },
                cancel: {
                    label: '取消',
                    className: 'btn-danger'
                }
            },
            callback: function (result) {
                if (result) {
                    $.ajax({
                        url: '../merchant/delOne/' + id,
                        type: 'delete',
                        success: function () {
                            $('#merchantsTable').bootstrapTable('refresh');
                        }
                    })
                }
            }
        })
    }

    //批量删除
    function deleteMany() {
        var rows = $('#merchantsTable').bootstrapTable('getSelections'); //获取表选择的行
        if (rows.length <= 0) {
            // 没选择
            bootbox.alert({
                size: "small",
                title: "提示",
                message: "请选择至少一行数据",
                callback: function () {
                },
                buttons: {
                    ok: {
                        label: '确定',
                        className: 'btn-success'
                    }
                }
            })
        } else {
            //提示确认是否删除
            bootbox.confirm({
                size: "small",
                title: "提示",
                message: "是否删除选中数据?",
                buttons: {
                    confirm: {
                        label: '确定',
                        className: 'btn-success'
                    },
                    cancel: {
                        label: '取消',
                        className: 'btn-danger'
                    }
                },
                callback: function (result) {
                    if (result) {
                        var ids = "";
                        for (var i = 0; i < rows.length; i++) {
                            ids += ids == "" ? rows[i].id : "," + rows[i].id;
                        }
                        //后台ajax删除
                        $.ajax({
                            url: "../merchant/deleteBrand/" + ids,
                            type: "delete",
                            data: {},
                            success: function (data) {
                                bootbox.alert({
                                    size: "small",
                                    title: "提示",
                                    message: "删除成功！",
                                    callback: function () {
                                    },
                                    buttons: {
                                        ok: {
                                            label: '确定',
                                            className: 'btn-success'
                                        }
                                    }
                                })
                                //刷新表格
                                $("#merchantsTable").bootstrapTable('refresh');
                            }
                        })

                    }
                }
            })
        }
    }

    //打开修改弹框
    function openUpdate(id) {
        bootbox.dialog({
            title: '修改用户',
            message: createAddContent("../page/toupdateshangjia"),
            closeButton: true,//是否显示关闭按钮
            buttons: {
                "success": {
                    "label": "<i class='icon-ok'></i> 保存",
                    "className": "btn-sm btn-success",
                    "callback": function () {
                        var id = $("#id").val();
                        var swag = $("#swag").val();
                        var promotionofgoods = $("#promotionofgoods").val();
                        var swagprice = $("#swagprice").val();
                        var promotionprice = $("#promotionprice").val();
                        /*var invoicetype = $("#invoicetype").val();*/
                        var invoicetype = $('#invoicetype input:radio:checked').val();
                        var invoicecontents = $("#invoicecontents").val();
                        var invoiceprice = $("#invoiceprice").val();

                        $.ajax({
                            url: '../merchant/updateMerchant',
                            contentType: 'application/json',
                            type: 'put',
                            // data:$("#bookForm").serialize(),
                            data: JSON.stringify({
                                'id': id,
                                'swag': swag,
                                'promotionofgoods': promotionofgoods,
                                'swagprice': swagprice,
                                'promotionprice': promotionprice,
                                'invoicetype': invoicetype,
                                'invoicecontents': invoicecontents,
                                'invoiceprice': invoiceprice
                            }),
                            success: function () {
                                $('#merchantsTable').bootstrapTable('refresh');
                            }
                        });
                    }
                },
                "cancel": {
                    "label": "<i class='icon-info'></i> 取消",
                    "className": "btn-sm btn-danger",
                    "callback": function () {

                    }
                }
            }

        });
        //回显数据
        $.ajax({
            url: '../merchant/findMarchantById/' + id,
            type: 'get',
            success: function (data) {
                $("#id").val(data.id);
                $("#swag").val(data.swag);
                $("#promotionofgoods").val(data.promotionofgoods);
                $("#swagprice").val(data.swagprice);
                $("#promotionprice").val(data.promotionprice);
                /*$("#invoicetype").val(data.invoicetype);*/
                $(":input[name='invoicetype']").each(function(){
                    var value=$(this).val();
                    if(value==data.invoicetype){
                        $(this).prop("checked",true);
                    }
                })
                $("#invoicecontents").val(data.invoicecontents);
                $("#invoiceprice").val(data.invoiceprice);

            }
        })

    }

</script>
</html>