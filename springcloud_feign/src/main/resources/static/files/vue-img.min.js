(function(t,r){typeof exports==="object"&&typeof module!=="undefined"?module.exports=r():typeof define==="function"&&define.amd?define(r):t.VueImg=r()})(this,function(){"use strict";var t=Object.create(null);t.canWebp=false;var r=new Image;r.onload=function(){t.canWebp=true};r.src="data:image/webp;base64,UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAsAAAABBxAREYiI/gcAAABWUDggGAAAADABAJ0BKgEAAQABABwlpAADcAD+/gbQAA==";var e=location.protocol==="https:"?"https://":"http://";var a=document.domain.match(/.(alpha|beta).ele(net)?.me$/);t.cdn=e+(a?"fuss"+a[0]:"fuss10.elemecdn.com");var n=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)};var o=document.documentElement;var i=function(t){var r=t.source;var e=t.target;var a=t.keys;a.forEach(function(t){if(n(r,t)){e[t]=r[t]}})};var u=function(t,r,e){if(e==="img"){t.src=r}else{t.style.backgroundImage="url('"+r+"')"}};var f=function(t){var r;var e=window.devicePixelRatio;var a=document.documentElement.getAttribute("data-dpr");var n=a?e/a:e;try{r=+(o.getAttribute("style").match(/(\d+)/)||[])[1]}catch(t){var i=o.offsetWidth;if(i/e>540){r=540*e/10}else{r=i/10}}r=r*n;if(Number(r)>=0&&typeof r==="number"){return t*r/75}else{return t}};var c=function(t){var r=t.getBoundingClientRect();return r.top>0&&r.bottom<window.innerHeight&&r.left>0&&r.right<window.innerWidth};var v=function(t){return t.replace(/^(\w)(\w\w)(\w{29}(\w*))$/,"/$1/$2/$3.$4")};var s=function(r){var e=r.format;var a=r.fallback;var n=/^(jpg|jpeg|png|gif)$/;if(n.test(e)){return"format/"+e+"/"}if(t.canWebp){return"format/webp/"}return n.test(a)?"format/"+a+"/":""};var h=function(t){var r=t.width;var e=t.height;var a=t.adapt;var n=r&&(a?f(r):r);var o=e&&(a?f(e):e);var i="thumbnail/";var u=n+"x"+o;if(r&&e){return i+"!"+u+"r/gravity/Center/crop/"+u+"/"}if(r){return""+i+n+"x/"}if(e){return i+"x"+o+"/"}return""};var l=function(r){if(r===void 0)r={};var e=r.hash;var a=r.adapt;var n=r.width;var o=r.height;var i=r.quality;var u=r.format;var f=r.fallback;var c=r.prefix;var l=r.suffix;if(!e||typeof e!=="string"){return""}var p=typeof c==="string"?c:t.cdn;var d=typeof i==="number"?"quality/"+i+"/":"";var g=s({format:u,fallback:f});var A=h({width:n,height:o,adapt:a});var m=typeof l==="string"?l:"";var y=""+d+g+A+m;return p+v(e)+(y?"?imageMogr/"+y:"")};var p=function(t){if(t===void 0)t={};var r=function r(){i({source:t,target:this,keys:["loading","error","quality","delay","prefix","suffix","adapt"]})};r.prototype.hashToSrc=function t(r){var e={hash:r};i({source:this,target:e,keys:["width","height","quality","format","fallback","adapt","prefix","suffix"]});return l(e)};var e=function(t){function r(r){var e=r&&typeof r==="object"?r:{hash:r};t.call(this);i({source:e,target:this,keys:["hash","loading","error","width","height","quality","format","fallback","adapt","prefix","suffix","defer"]})}if(t)r.__proto__=t;r.prototype=Object.create(t&&t.prototype);r.prototype.constructor=r;r.prototype.toImageSrc=function t(){return this.hashToSrc(this.hash)};r.prototype.toLoadingSrc=function t(){return this.hashToSrc(this.loading)};r.prototype.toErrorSrc=function t(){return this.hashToSrc(this.error)};return r}(r);return e};var d=function(t,r){var e=p(r);var a=[];var n=function(t,r,a){var n=new e(r.value);var o=n.toImageSrc();var i=n.toErrorSrc();if(!o){return Promise.resolve()}var f=new Image;var c=+n.delay||5e3;return new Promise(function(r){f.onload=function(){u(t,o,a.tag);r()};if(i){f.onerror=function(){u(t,i,a.tag);r()}}setTimeout(function(){r()},c);f.src=o})};t.directive("img",{bind:function t(r,o,i){var f=new e(o.value).toLoadingSrc();var c=o.value;var v=c.defer;if(f){u(r,f,i.tag)}if(!v){a.push(n(r,o,i))}},inserted:function r(e,o,i){var u=o.value;var f=u.defer;if(!f){return}if(c(e)){a.push(n(e,o,i))}else{t.nextTick(function(){Promise.all(a).then(function(){a.length=0;n(e,o,i)}).catch(function(){})})}},update:n})};t.getSrc=l;t.install=d;return t});